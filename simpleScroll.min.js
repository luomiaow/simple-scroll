/*!
 * SimpleScroll -- 简单的上拉加载插件
 * version 1.0.0
 * 2018-05-10
 */
(function(a,b){var c=typeof define==="function",d=typeof module!=="undefined"&&module.exports;if(c){define(b)}else{if(d){module.exports=b()}else{this[a]=b()}}})("SimpleScroll",function(){var a=function(b,d){var e=this;e.vision="1.0.0";e.options=d||{};e.isScrollBody=(!b||b=="body");e.scrollDom=e.isScrollBody?document.body:e.getDomById(b);e.hasNext=true;if(!e.scrollDom){return}var c=navigator.userAgent;e.isIos=!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);e.isUpScrolling=false;e.initUpScroll();setTimeout(function(){if(e.options.auto){e.controlState("load");e.options.callback()}},30)};a.prototype.initUpScroll=function(){var c=this;c.extendUpScroll(c.options);c.upwarp=document.createElement("div");c.upwarp.className="mescroll-upwarp";if(c.options.auto){c.upwarp.innerHTML=c.options.htmlLoading}var b=c.scrollDom;b.appendChild(c.upwarp);if(c.options.topBtn){c.showTopBtn()}c.preScrollY=0;this.scrollEvent=function(){var f=c.getScrollTop();var e=f-c.preScrollY>0;c.preScrollY=f;if(!c.isUpScrolling&&e){if(c.hasNext){var d=c.getScrollHeight()-c.getClientHeight()-f;if(d<c.options.offset){if(c.upwarp.innerHTML!=c.options.htmlLoading){c.controlState("load")}c.isUpScrolling=true;c.options.callback&&c.options.callback()}}}if(c.options.topBtn){if(f>c.options.offset){c.toTopDom.classList.remove("hideClass");c.toTopDom.classList.add("showClass")}else{c.toTopDom.classList.add("hideClass");c.toTopDom.classList.remove("showClass")}}c.options.onScroll&&c.options.onScroll(c,f)};if(this.isScrollBody){window.addEventListener("scroll",this.scrollEvent)}else{this.scrollDom.addEventListener("scroll",this.scrollEvent);if(this.isIos&&this.options.bounce){this.touchstartEvent=function(d){c.startPoint=c.getPoint(d)};this.touchmoveEvent=function(k){var j=c.getScrollTop();var d=c.getPoint(k);var i=d.y-c.startPoint.y;if(i>0){if(j<=0&&k.cancelable&&!k.defaultPrevented){k.preventDefault()}}else{if(i<0){var h=c.getScrollHeight();var f=c.getClientHeight();var g=h-f-j;if(k.cancelable&&!k.defaultPrevented&&g<=0){k.preventDefault()}}}};this.setBounce(false);this.scrollDom.addEventListener("touchstart",this.touchstartEvent);this.scrollDom.addEventListener("touchmove",this.touchmoveEvent)}}};a.prototype.extendUpScroll=function(b){this.extend(b,{auto:true,callback:null,noMoreSize:5,offset:100,htmlLoading:'<p class="upwarp-progress mescroll-rotate"></p><p class="upwarp-tip">加载中..</p>',htmlNodata:'<p class="upwarp-nodata">-- END --</p>',htmlEmpty:'<p class="upwrap-empty"><img class="empty-icon" src="./img/empty.png"/><p class="empty-text">没找到相关数据~</p></p>',htmlToTop:'<img src="./img/totop.png" alt="">',onScroll:null,bounce:true,topBtn:true,offset:1000})};a.prototype.controlState=function(c){var b=this;b.isUpScrolling=false;if(c=="load"){b.upwarp.innerHTML=b.options.htmlLoading;b.hasNext=true}else{if(c=="complete"){b.upwarp.innerHTML=b.options.htmlNodata;b.hasNext=false}else{if(c=="empty"){b.upwarp.innerHTML=b.options.htmlEmpty;b.hasNext=false}else{b.upwarp.innerHTML=""}}}};a.prototype.showTopBtn=function(){var b=this;b.toTopDom=document.createElement("div");b.toTopDom.className="to-top-wrap";b.toTopDom.innerHTML=b.options.htmlToTop;b.scrollDom.appendChild(b.toTopDom);b.toTopDom.onclick=function(){b.scrollTo(0)}};a.prototype.scrollTo=function(g,c){var d=this;c=c||300;var f=this.getScrollTop(),b;if(g>0){var e=this.getScrollHeight()-this.getClientHeight();b=g>e?e:g}else{b=0}d.isScrollTo=true;d.getStep(f,b,function(h){d.setScrollTop(h);if(h==b){d.isScrollTo=false}},c)};a.prototype.getStep=function(f,d,k,l,h){var j=d-f;if(l==0||j==0){k&&k(d);return}l=l||300;h=h||30;var g=l/h;var c=j/g;var e=0;var b=window.setInterval(function(){if(e<g-1){f+=c;k&&k(f,b);e++}else{k&&k(d,b);window.clearInterval(b)}},h)};a.prototype.getScrollHeight=function(){return this.scrollDom.scrollHeight};a.prototype.getClientHeight=function(){if(this.isScrollBody&&document.compatMode=="CSS1Compat"){return document.documentElement.clientHeight}else{return this.scrollDom.clientHeight}};a.prototype.getScrollTop=function(){if(this.isScrollBody){return document.documentElement.scrollTop||document.body.scrollTop}else{return this.scrollDom.scrollTop}};a.prototype.setScrollTop=function(b){if(this.isScrollBody){document.documentElement.scrollTop=b;document.body.scrollTop=b}else{this.scrollDom.scrollTop=b}};a.prototype.extend=function(d,b){if(!d){return b}for(var c in b){if(d[c]==null){d[c]=b[c]}else{if(typeof d[c]=="object"){this.extend(d[c],b[c])}}}return d};a.prototype.setBounce=function(b){if(b==false){window.addEventListener("touchmove",this.bounceTouchmove)}else{window.removeEventListener("touchmove",this.bounceTouchmove)}};a.prototype.bounceTouchmove=function(f){var d=f.target;var c=true;while(d!==document.body&&d!==document){var b=d.classList;if(b){if(b.contains("simple-scroll")){c=false;break}}d=d.parentNode}if(c&&f.cancelable&&!f.defaultPrevented){f.preventDefault()}};a.prototype.getPoint=function(b){return{x:b.touches?b.touches[0].pageX:b.clientX,y:b.touches?b.touches[0].pageY:b.clientY}},a.prototype.getDomById=function(b){if(!b){return}return document.getElementById(b)};a.prototype.destroy=function(){this.setBounce(true);if(this.isScrollBody){window.removeEventListener("scroll",this.scrollEvent)}else{this.scrollDom.removeEventListener("scroll",this.scrollEvent);if(this.isIos&&this.options.bounce){this.scrollDom.removeEventListener("touchstart",this.touchstartEvent);this.scrollDom.removeEventListener("touchmove",this.touchmoveEvent)}}};return a});